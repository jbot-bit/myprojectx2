STEP 1 — RAW DATA & CHART INTEGRITY (FOUNDATION)

Goal: Prove that what you see on charts == what’s in the database == what’s used in calculations.

If this fails, everything else is invalid.

1.1 Time & Session Integrity Tests

Tests to implement

Assert UTC → UTC+10 conversion is correct

Assert session boundaries are exact (no bleed)

Checks

Asia = 09:00–17:00

London = 18:00–23:00

NY = 23:00–02:00

ORBs exactly:

09:00–09:05

10:00–10:05

11:00–11:05

18:00–18:05

23:00–23:05

00:30–00:35

Test

SELECT
  COUNT(*) AS bad_rows
FROM bars_1m
WHERE
  (local_time < '09:00' OR local_time > '02:00')
  AND session IS NOT NULL;


Pass condition

bad_rows = 0

1.2 Candle Completeness & Continuity

Tests

No missing 1-minute bars during trading hours

No duplicate timestamps

1m → 5m aggregation consistency

Checks

-- Missing bars
SELECT date, COUNT(*) 
FROM bars_1m
GROUP BY date
HAVING COUNT(*) != expected_minutes;

-- Duplicate bars
SELECT timestamp, COUNT(*)
FROM bars_1m
GROUP BY timestamp
HAVING COUNT(*) > 1;


Pass

No missing

No duplicates

1.3 Chart Parity Test (CRITICAL)

Purpose: Prove charts are not lying.

Method

Pick 10 random dates

For each:

Export raw 1m OHLC from DB

Screenshot TradingView chart

Manually verify:

High

Low

Close

ORB boundaries

Automated helper

assert db_high == tv_high ± 1 tick
assert db_low == tv_low ± 1 tick


Pass

Differences only from known data vendor rounding

No systematic offset

1.4 ORB Construction Tests

Verify

ORB high = max(high) of first 5 mins

ORB low = min(low) of first 5 mins

Test

SELECT
  orb_high,
  MAX(high) AS computed_high,
  orb_low,
  MIN(low) AS computed_low
FROM bars_1m
WHERE time BETWEEN '10:00' AND '10:05'
GROUP BY date;


Pass

orb_high == computed_high

orb_low == computed_low

1.5 ATR & Volatility Inputs

ATR is used everywhere, so this must be bulletproof.

Checks

ATR uses historical bars only

No forward candles

Same ATR values in:

DB

Streamlit

Backtests

Test

SELECT date, atr_20
FROM daily_features_v2_half
WHERE atr_20 <= 0;


Pass

Zero rows

1.6 Zero-Lookahead Guardrails (Base Layer)

Before any strategy logic:

ORB data available after ORB closes

ATR available before ORB

Session labels used only after session end

Already partially validated in:

test_1800_pre_travel_filter.py 

test_1800_pre_travel_filter

FILTER_IMPLEMENTATION_COMPLETE.md 

FILTER_IMPLEMENTATION_COMPLETE

But this step enforces it at raw-data level.